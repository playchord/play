<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="normalize.css">
    <link rel="stylesheet" href="style.css">
    <title>Piano</title>
</head>
<body class="bg-1">
  <nav>
    <div class="menu">
      <select class="selector">
        <option>C major</option>
        <option>Db major</option>
        <option>D major</option>
        <option>Eb major</option>
        <option>E major</option>
        <option>F major</option>
        <option>Gb major</option>
        <option>G major</option>
        <option>Ab major</option>
        <option>A major</option>
        <option>Bb major</option>
        <option>B major</option>
        <option>C minor</option>
        <option>Db minor</option>
        <option>D minor</option>
        <option>Eb minor</option>
        <option>E minor</option>
        <option>F minor</option>
        <option>Gb minor</option>
        <option>G minor</option>
        <option>Ab minor</option>
        <option>A minor</option>
        <option>Bb minor</option>
        <option>B minor</option>
      </select>
      <button class="menuItem">
        Change background
      </button>
      <button class="menuItem" onclick="window.location.href = 'index2.html'">
        Go to Drum Kit
      </button>
    </div>
  </nav>

    <div class="keys">
          <button data-code="KeyA" class="key">
            <kbd>A</kbd>
            <span class="sound">I</span>
          </button>
          <button data-code="KeyS" class="key">
            <kbd>S</kbd>
            <span class="sound">II</span>
          </button>
          <button data-code="KeyD" class="key">
            <kbd>D</kbd>
            <span class="sound">III</span>
          </button>
          <button data-code="KeyF" class="key">
            <kbd>F</kbd>
            <span class="sound">IV</span>
          </button>
          <button data-code="KeyG" class="key">
            <kbd>G</kbd>
            <span class="sound">V</span>
          </button>
          <button data-code="KeyH" class="key">
            <kbd>H</kbd>
            <span class="sound">VI</span>
          </button>
          <button data-code="KeyJ" class="key">
            <kbd>J</kbd>
            <span class="sound">VII</span>
          </button>
          <button data-code="KeyK" class="key">
            <kbd>K</kbd>
            <span class="sound">VIII</span>
          </button>
    </div>

    <div class="keys2">
          <button id="chord1" data-code="KeyX" class="key">
              <kbd>X</kbd>
              <span class="sound">I CHORD</span>
            </button>
            <button id="chord2" data-code="KeyC" class="key">
              <kbd>C</kbd>
              <span class="sound">IV CHORD</span>
            </button>
            <button id="chord3" data-code="KeyV" class="key">
              <kbd>V</kbd>
              <span class="sound">V CHORD</span>
            </button>
            <button id="chord4" data-code="KeyB" class="key">
              <kbd>B</kbd>
              <span class="sound">VI CHORD</span>
            </button>
            <button id="chord5" data-code="KeyN" class="key">
              <kbd>N</kbd>
              <span class="sound">VIIb CHORD</span>
            </button>
    </div>

    <div class="showChords">
            <div id="show1" class="chordIndicatorOff">
              <span>C</span>
            </div>
            <div id="show2" class="chordIndicatorOff">
              <span>F</span>
            </div>
            <div id="show3" class="chordIndicatorOff">
              <span>G</span>
            </div>
            <div id="show4" class="chordIndicatorOff">
              <span>Am</span>
            </div>
            <div id="show5" class="chordIndicatorOff">
              <span>Bb</span>
            </div>
    </div>

        <div class="showKeys">
            <div data-note="C1" class="key2 keyFirst white">
            </div>
            <div data-note="Db1" class="key2 black">
            </div>
            <div data-note="D1" class="key2 white">
            </div>
            <div data-note="Eb1" class="key2 black">
            </div>
            <div data-note="E1" class="key2 white">
            </div>
            <div data-note="F1" class="key2 white">
            </div>
            <div data-note="Gb1" class="key2 black">
            </div>
            <div data-note="G1" class="key2 white">
            </div>
            <div data-note="Ab1" class="key2 black">
            </div>
            <div data-note="A1" class="key2 white">
            </div>
            <div data-note="Bb1" class="key2 black">
            </div>
            <div data-note="B1" class="key2 white">
            </div>
            <div data-note="C2" class="key2 white">
            </div>
            <div data-note="Db2" class="key2 black">
            </div>
            <div data-note="D2" class="key2 white">
            </div>
            <div data-note="Eb2" class="key2 black">
            </div>
            <div data-note="E2" class="key2 white">
            </div>
            <div data-note="F2" class="key2 white">
            </div>
            <div data-note="Gb2" class="key2 black">
            </div>
            <div data-note="G2" class="key2 white">
            </div>
            <div data-note="Ab2" class="key2 black">
            </div>
            <div data-note="A2" class="key2 white">
            </div>
            <div data-note="Bb2" class="key2 black">
            </div>
            <div data-note="B2" class="key2 white">
            </div>
            <div data-note="C3" class="key2 white">
            </div>
            <div data-note="Db3" class="key2 black">
            </div>
            <div data-note="D3" class="key2 white">
            </div>
            <div data-note="Eb3" class="key2 black">
            </div>
            <div data-note="E3" class="key2 white">
            </div>
            <div data-note="F3" class="key2 white">
            </div>
            <div data-note="Gb3" class="key2 black">
            </div>
            <div data-note="G3" class="key2 white">
            </div>
            <div data-note="Ab3" class="key2 black">
            </div>
            <div data-note="A3" class="key2 white">
            </div>
            <div data-note="Bb3" class="key2 black">
            </div>
            <div data-note="B3" class="key2 keyLast white">
            </div>
        </div>
            
    <audio data-code="KeyA" src="sounds2/C.wav"></audio>
    <audio data-code="KeyS" src="sounds2/D.wav"></audio>
    <audio data-code="KeyD" src="sounds2/E.wav"></audio>
    <audio data-code="KeyF" src="sounds2/F.wav"></audio>
    <audio data-code="KeyG" src="sounds2/G.wav"></audio>
    <audio data-code="KeyH" src="sounds2/A.wav"></audio>
    <audio data-code="KeyJ" src="sounds2/B.wav"></audio>
    <audio data-code="KeyK" src="sounds2/C2.wav"></audio>

    <audio data-code="KeyX" src="sounds2/chordC.wav"></audio>
    <audio data-code="KeyC" src="sounds2/chordF.wav"></audio>
    <audio data-code="KeyV" src="sounds2/chordG.wav"></audio>
    <audio data-code="KeyB" src="sounds2/chordAm.wav"></audio>
    <audio data-code="KeyN" src="sounds2/chordBb.wav"></audio>

  <script>
    // const keys = Array.from(document.querySelectorAll('.key'));
    // keys.forEach((key) => {
    //   key.addEventListener('transitionend', removeTransition);
    //   key.addEventListener("click", function(e) {
    //     key.classList.add("playing");
    //     const audio = document.querySelector(`audio[data-code="${key.dataset.code}"]`);
    //     audio.currentTime = 0;
    //     audio.play();
    //   })
    // });


    /*******************************/
    /* Declare costants & variables*/
    /*******************************/

    const keys = document.querySelector('.keys')
    const keys2 = document.querySelector('.keys2')
    const bottomKeys = document.querySelector('.showKeys')
    const chords = document.querySelector('.showChords')
    const body = document.body
    const nav = document.querySelector('.menuItem');

    let pressedKeys = [];


    /*************************/
    /* Adding event handlers */
    /*************************/

    keys.addEventListener('click', onKeyClick);
    keys2.addEventListener('click', onKeyClick);

    document.addEventListener('keydown', playSound);
    document.addEventListener('keyup', stopSound);

    keys.addEventListener('transitionend', removeTransition);
    keys2.addEventListener('transitionend', removeTransition);
    bottomKeys.addEventListener('transitionend', removeTransition);
    chords.addEventListener('transitionend', removeTransition);

    nav.addEventListener('click', function() {
      if (body.classList.contains('bg-1')) {
        body.classList.replace('bg-1', 'bg-2');
      } else {
        body.classList.replace('bg-2', 'bg-1');
      }
    });
    nav.addEventListener('transitionend', removeTransition);


    /********************/
    /* Declare Handlers */
    /********************/

    function onKeyClick(e) {
      const key = e.target.closest('button');
      if (!key) return;
      key.classList.add('playing');
      const audio = document.querySelector(`audio[data-code="${key.dataset.code}"]`);
      audio.currentTime = 0;
      audio.play();
    }

    function removeTransition(e) {
      if (e.propertyName !== 'transform') return;
      const key = e.target.closest('button') || e.target
      key.classList.remove('playing', 'glow', 'chordIndicatorOn');
    }

    function playSound(e) {
        console.log('playSound() called');
        let alreadyPressed = pressedKeys.indexOf(e.code) > -1;
        if (!alreadyPressed) {
            console.log('pressedKeys:', pressedKeys);
            console.log('New key pressing received...');
            pressedKeys.push(e.code);

            const audio = document.querySelector(`audio[data-code="${e.code}"]`);
            const key = document.querySelector(`button[data-code="${e.code}"]`);
            if (!audio) return;
            if (!key) console.warn('Audio without key UI found !!!')
            console.log('sound going to play!');

            if (key.id === 'chord1') glow1();
            if (key.id === 'chord2') glow2();
            if (key.id === 'chord3') glow3();
            if (key.id === 'chord4') glow4();
            if (key.id === 'chord5') glow5();

            key.classList.add('playing');
            audio.currentTime = 0;
            audio.play();
        } else console.log('already pressed!');
    }

    function stopSound(e) {
        console.log('stopSound() called');
        console.log('pressedKeys:', pressedKeys);
        console.log('key released:', e.code);
        const keyIndex = pressedKeys.indexOf(e.code)
        pressedKeys.splice(keyIndex, 1);
        console.log('pressedKeys:', pressedKeys);
    }


    /****************/
    /* Unstructured */
    /****************/

    const keyC1 = document.querySelector('div[data-note="C1"');
    const keyDb1 = document.querySelector('div[data-note="Db1"');
    const keyD1 = document.querySelector('div[data-note="D1"');
    const keyEb1 = document.querySelector('div[data-note="Eb1"');
    const keyE1 = document.querySelector('div[data-note="E1"');
    const keyF1 = document.querySelector('div[data-note="F1"');
    const keyGb1 = document.querySelector('div[data-note="Gb1"');
    const keyG1 = document.querySelector('div[data-note="G1"');
    const keyAb1 = document.querySelector('div[data-note="Ab1"');
    const keyA1 = document.querySelector('div[data-note="A1"');
    const keyBb1 = document.querySelector('div[data-note="Bb1"');
    const keyB1 = document.querySelector('div[data-note="B1"');
    const keyC2 = document.querySelector('div[data-note="C2"');
    const keyDb2 = document.querySelector('div[data-note="Db2"');
    const keyD2 = document.querySelector('div[data-note="D2"');
    const keyEb2 = document.querySelector('div[data-note="Eb2"');
    const keyE2 = document.querySelector('div[data-note="E2"');
    const keyF2 = document.querySelector('div[data-note="F2"');
    const keyGb2 = document.querySelector('div[data-note="Gb2"');
    const keyG2 = document.querySelector('div[data-note="G2"');
    const keyAb2 = document.querySelector('div[data-note="Ab2"');
    const keyA2 = document.querySelector('div[data-note="A2"');
    const keyBb2 = document.querySelector('div[data-note="Bb2"');
    const keyB2 = document.querySelector('div[data-note="B2"');
    const keyC3 = document.querySelector('div[data-note="C3"');
    const keyDb3 = document.querySelector('div[data-note="Db3"');
    const keyD3 = document.querySelector('div[data-note="D3"');
    const keyEb3 = document.querySelector('div[data-note="Eb3"');
    const keyE3 = document.querySelector('div[data-note="E3"');
    const keyF3 = document.querySelector('div[data-note="F3"');
    const keyGb3 = document.querySelector('div[data-note="Gb3"');
    const keyG3 = document.querySelector('div[data-note="G3"');
    const keyAb3 = document.querySelector('div[data-note="Ab3"');
    const keyA3 = document.querySelector('div[data-note="A3"');
    const keyBb3 = document.querySelector('div[data-note="Bb3"');
    const keyB3 = document.querySelector('div[data-note="B3"');

    const chordC = document.querySelector('button[data-code="KeyX"');
    const chordF = document.querySelector('button[data-code="KeyC"');
    const chordG = document.querySelector('button[data-code="KeyV"');
    const chordA = document.querySelector('button[data-code="KeyB"');
    const chordBb = document.querySelector('button[data-code="KeyN"');


    chordC.addEventListener('click', glow1)
    chordF.addEventListener('click', glow2)
    chordG.addEventListener('click', glow3)
    chordA.addEventListener('click', glow4)
    chordBb.addEventListener('click', glow5)

    function glow1(e) {
        document.querySelector('#show1').classList.add('chordIndicatorOn');
        keyC1.classList.add('glow');
        keyC2.classList.add('glow');
        keyG2.classList.add('glow');
        keyC3.classList.add('glow');
        keyE3.classList.add('glow');
        keyG3.classList.add('glow');
    }

    function glow2(e) {
        document.querySelector('#show2').classList.add('chordIndicatorOn');
        keyF1.classList.add('glow');
        keyF2.classList.add('glow');
        keyA2.classList.add('glow');
        keyC3.classList.add('glow');
        keyF3.classList.add('glow');
        keyA3.classList.add('glow');
    }

    function glow3(e) {
        document.querySelector('#show3').classList.add('chordIndicatorOn');
        keyG1.classList.add('glow');
        keyG2.classList.add('glow');
        keyB2.classList.add('glow');
        keyD3.classList.add('glow');
        keyG3.classList.add('glow');
    }

    function glow4(e) {
        document.querySelector('#show4').classList.add('chordIndicatorOn');
        keyA1.classList.add('glow');
        keyE2.classList.add('glow');
        keyA2.classList.add('glow');
        keyC3.classList.add('glow');
        keyE3.classList.add('glow');
    }

    function glow5(e) {
        document.querySelector('#show5').classList.add('chordIndicatorOn');
        keyBb1.classList.add('glow');
        keyF2.classList.add('glow');
        keyBb2.classList.add('glow');
        keyD3.classList.add('glow');
        keyF3.classList.add('glow');
    }

  </script>

</body>
</html>