<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="normalize.css">
    <link rel="stylesheet" href="style.css">
    <title>Piano</title>
</head>
<body class="bg-1">
  <nav>
    <div class="menu">
      <select class="selector">
        <option>C major</option>
        <option>Db major</option>
        <option>D major</option>
        <option>Eb major</option>
        <option>E major</option>
        <option>F major</option>
        <option>Gb major</option>
        <option>G major</option>
        <option>Ab major</option>
        <option>A major</option>
        <option>Bb major</option>
        <option>B major</option>
        <option>C minor</option>
        <option>Db minor</option>
        <option>D minor</option>
        <option>Eb minor</option>
        <option>E minor</option>
        <option>F minor</option>
        <option>Gb minor</option>
        <option>G minor</option>
        <option>Ab minor</option>
        <option>A minor</option>
        <option>Bb minor</option>
        <option>B minor</option>
      </select>
      <button class="menuItem">
        Change background
      </button>
      <button class="menuItem" onclick="window.location.href = 'index2.html'">
        Go to Drum Kit
      </button>
    </div>
  </nav>

    <div class="keys">
          <button data-code="KeyA" class="key">
            <kbd>A</kbd>
            <span class="sound">I</span>
          </button>
          <button data-code="KeyS" class="key">
            <kbd>S</kbd>
            <span class="sound">II</span>
          </button>
          <button data-code="KeyD" class="key">
            <kbd>D</kbd>
            <span class="sound">III</span>
          </button>
          <button data-code="KeyF" class="key">
            <kbd>F</kbd>
            <span class="sound">IV</span>
          </button>
          <button data-code="KeyG" class="key">
            <kbd>G</kbd>
            <span class="sound">V</span>
          </button>
          <button data-code="KeyH" class="key">
            <kbd>H</kbd>
            <span class="sound">VI</span>
          </button>
          <button data-code="KeyJ" class="key">
            <kbd>J</kbd>
            <span class="sound">VII</span>
          </button>
          <button data-code="KeyK" class="key">
            <kbd>K</kbd>
            <span class="sound">VIII</span>
          </button>
    </div>

    <div class="keys2">
          <button id="chord1" data-code="KeyX" data-chord="1" class="key">
              <kbd>X</kbd>
              <span class="sound">I CHORD</span>
            </button>
            <button id="chord2" data-code="KeyC" data-chord="2" class="key">
              <kbd>C</kbd>
              <span class="sound">IV CHORD</span>
            </button>
            <button id="chord3" data-code="KeyV" data-chord="3" class="key">
              <kbd>V</kbd>
              <span class="sound">V CHORD</span>
            </button>
            <button id="chord4" data-code="KeyB" data-chord="4" class="key">
              <kbd>B</kbd>
              <span class="sound">VI CHORD</span>
            </button>
            <button id="chord5" data-code="KeyN" data-chord="5" class="key">
              <kbd>N</kbd>
              <span class="sound">VIIb CHORD</span>
            </button>
    </div>

    <div class="showChords">
            <div id="show1" class="chordIndicatorOff">
              <span>C</span>
            </div>
            <div id="show2" class="chordIndicatorOff">
              <span>F</span>
            </div>
            <div id="show3" class="chordIndicatorOff">
              <span>G</span>
            </div>
            <div id="show4" class="chordIndicatorOff">
              <span>Am</span>
            </div>
            <div id="show5" class="chordIndicatorOff">
              <span>Bb</span>
            </div>
    </div>
        <div class="showKeys">
            <div data-note="C1" data-chords="chord1" class="key2 keyFirst white"></div>
            <div data-note="Db1" data-chords="" class="key2 black"></div>
            <div data-note="D1"  data-chords="" class="key2 white"></div>
            <div data-note="Eb1"  data-chords="" class="key2 black"></div>
            <div data-note="E1" data-chords="" class="key2 white"></div>
            <div data-note="F1" data-chords="chord2" class="key2 white"></div>
            <div data-note="Gb1" data-chords="" class="key2 black"></div>
            <div data-note="G1" data-chords="chord3" class="key2 white"></div>
            <div data-note="Ab1" data-chords="" class="key2 black"></div>
            <div data-note="A1" data-chords="chord4" class="key2 white"></div>
            <div data-note="Bb1" data-chords="chord5" class="key2 black"></div>
            <div data-note="B1" data-chords="" class="key2 white"></div>
            <div data-note="C2" data-chords="chord1" class="key2 white"></div>
            <div data-note="Db2" data-chords="" class="key2 black"></div>
            <div data-note="D2" data-chords="" class="key2 white"></div>
            <div data-note="Eb2" data-chords="" class="key2 black"></div>
            <div data-note="E2" data-chords="chord4" class="key2 white"></div>
            <div data-note="F2" data-chords="chord2 chord5" class="key2 white"></div>
            <div data-note="Gb2" data-chords="" class="key2 black"></div>
            <div data-note="G2" data-chords="chord1 chord3" class="key2 white"></div>
            <div data-note="Ab2" data-chords="" class="key2 black"></div>
            <div data-note="A2" data-chords="chord2 chord4" class="key2 white"></div>
            <div data-note="Bb2" data-chords="chord5" class="key2 black"></div>
            <div data-note="B2" data-chords="chord3" class="key2 white"></div>
            <div data-note="C3" data-chords="chord1 chord2 chord4" class="key2 white"></div>
            <div data-note="Db3" data-chords="" class="key2 black"></div>
            <div data-note="D3" data-chords="chord3 chord5" class="key2 white"></div>
            <div data-note="Eb3" data-chords="" class="key2 black"></div>
            <div data-note="E3" data-chords="chord1 chord4" class="key2 white"></div>
            <div data-note="F3" data-chords="chord2 chord5" class="key2 white"></div>
            <div data-note="Gb3" data-chords="" class="key2 black"></div>
            <div data-note="G3" data-chords="chord1 chord3" class="key2 white"></div>
            <div data-note="Ab3" data-chords="" class="key2 black"></div>
            <div data-note="A3" data-chords="chord2" class="key2 white"></div>
            <div data-note="Bb3" data-chords="" class="key2 black"></div>
            <div data-note="B3" data-chords="" class="key2 keyLast white"></div>
        </div>

    <audio data-code="KeyA" src="sounds2/C.wav"></audio>
    <audio data-code="KeyS" src="sounds2/D.wav"></audio>
    <audio data-code="KeyD" src="sounds2/E.wav"></audio>
    <audio data-code="KeyF" src="sounds2/F.wav"></audio>
    <audio data-code="KeyG" src="sounds2/G.wav"></audio>
    <audio data-code="KeyH" src="sounds2/A.wav"></audio>
    <audio data-code="KeyJ" src="sounds2/B.wav"></audio>
    <audio data-code="KeyK" src="sounds2/C2.wav"></audio>

    <audio data-code="KeyX" src="sounds2/chordC.wav"></audio>
    <audio data-code="KeyC" src="sounds2/chordF.wav"></audio>
    <audio data-code="KeyV" src="sounds2/chordG.wav"></audio>
    <audio data-code="KeyB" src="sounds2/chordAm.wav"></audio>
    <audio data-code="KeyN" src="sounds2/chordBb.wav"></audio>

  <script>

    /*******************************/
    /* Declare costants & variables*/
    /*******************************/

    const keys = document.querySelector('.keys')
    const chords = document.querySelector('.keys2')
    const keyboard = document.querySelector('.showKeys')
    const chordHints = document.querySelector('.showChords')
    const body = document.body
    const nav = document.querySelector('.menuItem');

    let pressedKeys = [];


    /*************************/
    /* Adding event handlers */
    /*************************/

    keys.addEventListener('click', onKeyClick);
    chords.addEventListener('click', onKeyClick);

    document.addEventListener('keydown', onKeyDown);
    document.addEventListener('keyup', onKeyUp);

    keys.addEventListener('transitionend', onTransitionEnd);
    chords.addEventListener('transitionend', onTransitionEnd);
    keyboard.addEventListener('transitionend', onTransitionEnd);
    chordHints.addEventListener('transitionend', onTransitionEnd);
    nav.addEventListener('transitionend', onTransitionEnd);

    nav.addEventListener('click', changeBackground);


    /********************/
    /* Declare Handlers */
    /********************/

    function onKeyClick(e) {
      const key = e.target.closest('button');
      if (!key) return;
      key.classList.add('playing');

      playSound(key.dataset.code);
      makeChordGlow(key);
    }

    function onKeyDown(e) {
      let alreadyPressed = pressedKeys.indexOf(e.code) > -1;
      if (!alreadyPressed) {
          pressedKeys.push(e.code);

          const key = document.querySelector(`button[data-code="${e.code}"]`);
          if (!key) return;
          key.classList.add('playing');

          playSound(e.code);
          makeChordGlow(key);
      } else console.log('already pressed!');
    }

    function onKeyUp(e) {
      const keyIndex = pressedKeys.indexOf(e.code)
      pressedKeys.splice(keyIndex, 1);

      const key = document.querySelector(`button[data-code="${e.code}"]`);
      if (!key) return;
      removeHighlighting(key);
    }

    function playSound(keyCode) {
      const audio = document.querySelector(`audio[data-code="${keyCode}"]`);
      if (!audio) return;
      audio.currentTime = 0;
      audio.play();
    }

    function makeChordGlow (keyElement) {
      const isChord = keyElement.getAttribute('data-chord');
      if (isChord) glow(keyElement);
    }

    function glow(clickedChord) {
        const chordNum = clickedChord.getAttribute('data-chord');
        document.querySelector(`#show${chordNum}`).classList.add('chordIndicatorOn');
        const chordKeys = document.querySelectorAll(`[data-chords*=chord${chordNum}]`)
        chordKeys.forEach(key => key.classList.add('glow'));
    }

    function onTransitionEnd(e) {
      if (e.propertyName !== 'transform') return;
      const key = e.target.closest('button') || e.target;
      const keyCode = key.getAttribute('data-code');
      const keyIsPressed = pressedKeys.indexOf(keyCode) > -1
      if (!keyIsPressed) removeHighlighting(key);
    }

    function removeHighlighting(key) {
      key.classList.remove('playing', 'glow', 'chordIndicatorOn');
    }

    function changeBackground() {
      if (body.classList.contains('bg-1')) {
        body.classList.replace('bg-1', 'bg-2');
      } else {
        body.classList.replace('bg-2', 'bg-1');
      }
    }
  </script>

</body>
</html>